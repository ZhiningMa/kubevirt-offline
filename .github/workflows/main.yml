name: Download KubeVirt Core Images
on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Pull KubeVirt Core Images
        run: |
          # 锁定稳定版本 v1.2.1
          export KVERSION="v1.2.1"
          
          images=("virt-operator" "virt-api" "virt-controller" "virt-handler" "virt-launcher")
          
          for img in "${images[@]}"; do
            echo "Pulling kubevirt/${img}:${KVERSION}..."
            docker pull kubevirt/${img}:${KVERSION}
          done
          
          echo "Saving core images to tarball..."
          docker save -o kubevirt-core-v1.2.1.tar \
            kubevirt/virt-operator:${KVERSION} \
            kubevirt/virt-api:${KVERSION} \
            kubevirt/virt-controller:${KVERSION} \
            kubevirt/virt-handler:${KVERSION} \
            kubevirt/virt-launcher:${KVERSION}

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: kubevirt-core-bundle
          path: kubevirt-core-v1.2.1.tar
          retention-days: 1
